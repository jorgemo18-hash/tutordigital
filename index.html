<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ttutordigital</title>

  <style>
    /* ---------- BASE ---------- */
    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;
      background:#fafafa;
      color:#111;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
    }

    .card{
      background:#fff;
      padding:24px;
      border-radius:16px;
      max-width:520px;
      width:92%;
      box-shadow:0 10px 30px rgba(0,0,0,.08);
    }

    .tag{
      display:inline-block;
      font-size:13px;
      padding:6px 10px;
      border-radius:999px;
      background:#eee;
      margin-bottom:12px;
    }

    h1{
      margin:0 0 10px;
      font-size:28px;
    }

    p{
      margin:0 0 10px;
      line-height:1.5;
      color:#333;
    }

    .note{
      margin-top:10px;
      font-size:13px;
      color:#666;
    }

    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:14px;
    }

    button.btn{
      display:inline-block;
      font-weight:700;
      border-radius:12px;
      padding:10px 14px;
      border:1px solid #111;
      cursor:pointer;
      background:#111;
      color:#fff;
    }

    /* ---------- MODAL CHAT ---------- */
    .modalOverlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.35);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:1000;
      opacity:0;
      pointer-events:none;
      transition:opacity .25s ease;
    }

    .modalOverlay.open{
      opacity:1;
      pointer-events:auto;
    }

    .modal{
      width:min(900px, 96vw);
      height:min(720px, 90vh);
      background:#fff;
      border-radius:18px;
      overflow:hidden;
      box-shadow:0 20px 60px rgba(0,0,0,.25);
      display:flex;
      flex-direction:column;
      transform:translateY(20px) scale(.96);
      transition:transform .25s ease;
    }

    .modalOverlay.open .modal{
      transform:translateY(0) scale(1);
    }

    .modalTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px 12px;
      border-bottom:1px solid #eee;
      font-weight:800;
    }

    .modalTop button{
      border:0;
      background:#f2f2f2;
      padding:8px 10px;
      border-radius:10px;
      cursor:pointer;
      font-weight:700;
    }

    .modal iframe{
      flex:1;
      width:100%;
      border:0;
    }

    /* ---------- MINI BAR ---------- */
    .miniBar{
      position:fixed;
      right:18px;
      bottom:18px;
      display:none;
      align-items:center;
      gap:10px;
      background:#111;
      color:#fff;
      padding:10px 12px;
      border-radius:14px;
      box-shadow:0 12px 30px rgba(0,0,0,.25);
      z-index:1100;
    }

    .miniBar .label{
      font-weight:800;
      font-size:14px;
      white-space:nowrap;
    }

    .miniBar button{
      border:0;
      border-radius:10px;
      cursor:pointer;
      font-weight:800;
      padding:6px 10px;
    }

    .miniBar .openBtn{
      background:#fff;
      color:#111;
    }

    .miniBar .closeMini{
      background:rgba(255,255,255,.2);
      color:#fff;
    }
    .miniBar input{
  width:240px;
  max-width:40vw;
  padding:8px 10px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.25);
  background:rgba(255,255,255,.12);
  color:#fff;
  outline:none;
  font-size:16px;
}

.miniBar input::placeholder{
  color:rgba(255,255,255,.75);
}
  </style>
</head>

<body>

  <!-- MODAL -->
  <div class="modalOverlay" id="overlay" aria-hidden="true">
    <div class="modal">
     <div class="modalTop">
  <div>Ttutordigital · Chat</div>
  <div>
    <button id="minimizeChat" type="button">Minimizar</button>
    <button id="closeChat" type="button">Cerrar</button>
  </div>
</div>
      <iframe src="./app.html" title="Chat"></iframe>
    </div>
  </div>

  <!-- MINI BAR -->
  <!-- MINI BAR -->
<div class="miniBar" id="miniBar" aria-hidden="true">
  <div class="label">Ttutordigital · Chat</div>

  <input id="miniInput" type="text" placeholder="Escribe…" />

  <button class="openBtn" id="miniSend" type="button">Enviar</button>
  <button class="closeMini" id="miniClose" type="button">×</button>
</div>

  <!-- PORTADA -->
  <div class="card">
    <div class="tag">Ttutordigital</div>
    <h1>Tutor digital para alumnos</h1>
    <p>Organización diaria, prioridades claras y acompañamiento para ponerse a estudiar.</p>
    <p class="note">Demo funcional. Validando experiencia.</p>

    <div class="row">
      <button class="btn" id="openChat">Entrar a la app</button>
    </div>
  </div>

  <!-- JS -->
<script>
  const isMobile = window.matchMedia("(max-width: 768px)").matches;

  const openBtn      = document.getElementById("openChat");
  const overlay      = document.getElementById("overlay");

  const minimizeBtn  = document.getElementById("minimizeChat");
  const closeBtn     = document.getElementById("closeChat");

  const miniBar      = document.getElementById("miniBar");
  const miniOpen     = document.getElementById("miniOpen");
  const miniClose    = document.getElementById("miniClose");

  const STORAGE_KEY = "ttutordigital_chat_state"; 
  const miniInput = document.getElementById("miniInput");
const miniSend  = document.getElementById("miniSend");
  // valores: "open" | "minimized" | "closed"

  /* ---------- UTILIDADES ---------- */
  function setState(v){
    try { localStorage.setItem(STORAGE_KEY, v); } catch(e){}
  }
  function getState(){
    try { return localStorage.getItem(STORAGE_KEY) || "closed"; }
    catch(e){ return "closed"; }
  }

  function focusChatInput(){
    const frame = overlay?.querySelector("iframe");
    if(frame && frame.contentWindow){
      frame.contentWindow.postMessage("focusInput", "*");
    }
  }

  /* ---------- ACCIONES ---------- */
  function openChat(){
    if(isMobile){
      window.location.href = "./app.html";
      return;
    }
    overlay.classList.add("open");
    overlay.setAttribute("aria-hidden","false");

    miniBar.style.display = "none";
    miniBar.setAttribute("aria-hidden","true");

    setState("open");
    focusChatInput();
  }

  function minimizeChat(){
    overlay.classList.remove("open");
    overlay.setAttribute("aria-hidden","true");

    if(!isMobile){
      miniBar.style.display = "flex";
      miniBar.setAttribute("aria-hidden","false");
    }

    setState("minimized");
  }

  function closeChat(){
    overlay.classList.remove("open");
    overlay.setAttribute("aria-hidden","true");

    miniBar.style.display = "none";
    miniBar.setAttribute("aria-hidden","true");

    setState("closed");
  }
  function sendMiniText(){
  const text = miniInput.value.trim();
  if(!text) return;

  // Abrimos el chat
  openChat();

  // Mandamos texto al iframe para que lo procese como mensaje del usuario
  const frame = overlay.querySelector("iframe");
  if(frame && frame.contentWindow){
    frame.contentWindow.postMessage({ type: "sendText", text }, "*");
  }

  // Limpia el mini input
  miniInput.value = "";
}

  /* ---------- EVENTOS ---------- */
  openBtn?.addEventListener("click", openChat);
  minimizeBtn?.addEventListener("click", minimizeChat);
  closeBtn?.addEventListener("click", closeChat);

  miniOpen?.addEventListener("click", openChat);
  miniClose?.addEventListener("click", closeChat);

  overlay?.addEventListener("click", (e) => {
    if(e.target === overlay) minimizeChat();
  });

  document.addEventListener("keydown", (e) => {
    if(e.key === "Escape") minimizeChat();
  });

  /* ---------- RESTAURAR ESTADO ---------- */
  /* ---------- RESTAURAR ESTADO ---------- */
window.addEventListener("load", () => {
  if(isMobile) return;

  const state = getState();

  // IMPORTANTE: nunca abrir automáticamente al cargar
  overlay.classList.remove("open");
  overlay.setAttribute("aria-hidden","true");

  if(state === "minimized" || state === "open"){
    // Si antes estaba abierto o minimizado, mostramos la minibarra
    miniBar.style.display = "flex";
    miniBar.setAttribute("aria-hidden","false");
    setState("minimized"); // normalizamos para que no vuelva a auto-abrir
  } else {
    // closed
    miniBar.style.display = "none";
    miniBar.setAttribute("aria-hidden","true");
  }

  // Eventos mini input
  miniSend.addEventListener("click", sendMiniText);
  miniInput.addEventListener("keydown", (e) => {
    if(e.key === "Enter") sendMiniText();
  });
});
</script>

</body>
</html>
