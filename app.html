<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ttutordigital ¬∑ App</title>
  <style>
    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;
      background:#fff;
      color:#111;
      height:100vh;
      display:flex;
      flex-direction:column;
    }

    header{
      display:flex;
      gap:12px;
      align-items:center;
      padding:14px;
      border-bottom:1px solid #eee;
      background:#fff;
      position:sticky;
      top:0;
      z-index:10;
    }

    a.back{
      text-decoration:none;
      color:#111;
      font-weight:700;
    }

    .title{font-weight:900;}
    .sub{font-size:13px;color:#666;margin-top:2px;}

    main{
      flex:1;
      overflow:auto;
      background:#fafafa;
      padding:14px;
    }

    /* ---------- AGENDA ---------- */
    .agenda{
      background:#fff;
      border:1px solid #eee;
      border-radius:16px;
      padding:14px;
      box-shadow:0 10px 30px rgba(0,0,0,.05);
      margin-bottom:14px;
    }

    .agendaTitle{
      font-weight:900;
      margin-bottom:10px;
    }

    .block{
      border:1px solid #eee;
      border-radius:14px;
      padding:12px;
      margin-bottom:10px;
      background:#fff;
    }

    .blockTitle{
      font-weight:900;
      margin-bottom:6px;
    }

    .blockText{
      font-size:14px;
      color:#333;
    }

    .alist{
      margin:0;
      padding-left:18px;
      color:#333;
      font-size:14px;
      line-height:1.45;
    }

    .hint{
      margin-top:8px;
      font-size:13px;
      color:#666;
    }

    /* Bloques clicables */
    .agendaBtn{
      cursor:pointer;
      transition:background .15s ease, transform .1s ease, border-color .15s ease;
    }
    .agendaBtn:hover{
      background:#f7f7f7;
      transform:translateY(-1px);
      border-color:#e6e6e6;
    }
    .agendaBtn:active{
      transform:translateY(0);
    }

    /* ---------- CHAT ---------- */
    .row{display:flex;margin-bottom:10px;}
    .bubble{
      max-width:560px;
      padding:10px 12px;
      border-radius:14px;
      white-space:pre-wrap;
      line-height:1.35;
      box-shadow:0 1px 0 rgba(0,0,0,.04);
    }
    .a{justify-content:flex-start;}
    .a .bubble{background:#f2f2f2;}
    .u{justify-content:flex-end;}
    .u .bubble{background:#111;color:#fff;}

    footer{
      display:flex;
      gap:8px;
      padding:12px;
      border-top:1px solid #eee;
      background:#fff;
      position:sticky;
      bottom:0;
    }

    input{
      flex:1;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid #ddd;
      outline:none;
    }

    button{
      padding:10px 14px;
      border-radius:10px;
      border:1px solid #111;
      background:#111;
      color:#fff;
      font-weight:800;
      cursor:pointer;
    }
    button:disabled{opacity:.5;cursor:default;}
  </style>
</head>
<body>

<header>
  <a class="back" href="./index.html">‚Üê Inicio</a>
  <div>
    <div class="title">Ttutordigital</div>
    <div class="sub">Modo alumno ¬∑ Demo</div>
  </div>
</header>

<main id="chat">
  <!-- Agenda fija arriba -->
  <div class="agenda" id="agenda"></div>

  <!-- Conversaci√≥n -->
  <div id="msgs"></div>
</main>

<footer>
  <input id="inp" placeholder="Escribe aqu√≠‚Ä¶" />
  <button id="btn" disabled>Enviar</button>
</footer>

<script>
  const chatScroll = document.getElementById("chat");
  const agenda = document.getElementById("agenda");
  const msgs = document.getElementById("msgs");
  const inp = document.getElementById("inp");
  const btn = document.getElementById("btn");

  // --------- DATOS DEMO ---------
  const demoData = {
    homework: [
      "Lengua ¬∑ Ejercicios 3 y 4",
      "Tecnolog√≠a ¬∑ Ejercicios 1 y 2",
      "Matem√°ticas ¬∑ Problema 5"
    ],
    exam: "Matem√°ticas ¬∑ viernes",
    project: "Historia ¬∑ entrega en 15 d√≠as"
  };

  // --------- STORAGE / REINICIO DIARIO (modo 2) ---------
  const DAY_KEY = "ttd_chat_day";
  const CHAT_KEY = "ttd_chat_log";

  function todayStr(){
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,"0");
    const day = String(d.getDate()).padStart(2,"0");
    return `${y}-${m}-${day}`;
  }

  function loadLog(){
    try{
      return JSON.parse(localStorage.getItem(CHAT_KEY) || "[]");
    }catch(e){
      return [];
    }
  }

  function saveLog(log){
    localStorage.setItem(CHAT_KEY, JSON.stringify(log));
  }

  function resetChat(){
    msgs.innerHTML = "";
    const init = [
      { role:"assistant", text:"Esta es tu agenda de hoy. Elige por d√≥nde quieres empezar y lo vemos juntos." }
    ];
    saveLog(init);
    renderLog(init);
  }

  function ensureToday(){
    const saved = localStorage.getItem(DAY_KEY);
    const t = todayStr();
    if(saved !== t){
      localStorage.setItem(DAY_KEY, t);
      resetChat();
    }
  }

  // --------- RENDER AGENDA ---------
  function renderAgenda(){
    agenda.innerHTML = `
      <div class="agendaTitle">Agenda de hoy</div>

      <div class="block agendaBtn" data-action="DEBERES">
        <div class="blockTitle">üìò Deberes de ma√±ana</div>
        <ul class="alist">
          ${demoData.homework.map(x => `<li>${x}</li>`).join("")}
        </ul>
      </div>

      <div class="block agendaBtn" data-action="EXAMEN">
        <div class="blockTitle">üìù Pr√≥ximo examen</div>
        <div class="blockText">${demoData.exam}</div>
      </div>

      <div class="block agendaBtn" data-action="TRABAJO">
        <div class="blockTitle">üìÇ Trabajo</div>
        <div class="blockText">${demoData.project}</div>
      </div>

      <div class="hint">
        üí° Mi sugerencia: empieza por los deberes de ma√±ana. Suele ayudar quitarse primero lo que requiere m√°s atenci√≥n.
      </div>
    `;

    document.querySelectorAll(".agendaBtn").forEach(el => {
      el.addEventListener("click", () => {
        sendText(el.dataset.action);
      });
    });
  }

  // --------- CHAT UI ---------
  function addBubble(role, text){
    const row = document.createElement("div");
    row.className = "row " + (role === "user" ? "u" : "a");
    const bub = document.createElement("div");
    bub.className = "bubble";
    bub.textContent = text;
    row.appendChild(bub);
    msgs.appendChild(row);
  }

  function renderLog(log){
    msgs.innerHTML = "";
    log.forEach(m => addBubble(m.role, m.text));
    scrollToBottom();
  }

  function scrollToBottom(){
    chatScroll.scrollTop = chatScroll.scrollHeight;
  }

  // --------- RESPUESTAS DEMO ---------
  function demoAnswer(t){
    const raw = String(t || "").trim();
    const low = raw.toLowerCase();

    // Acciones de agenda
    if(raw === "DEBERES" || low.includes("deberes")){
      return `Perfecto. Vamos con los deberes para ma√±ana.\n\nDime cu√°l hacemos primero (Lengua / Tecnolog√≠a / Matem√°ticas) y te lo organizo paso a paso.`;
    }

    if(raw === "EXAMEN" || low.includes("examen")){
      return `Vale. Pr√≥ximo examen: ${demoData.exam}.\n\n¬øQuieres que hagamos un plan corto de repaso para hoy (10‚Äì15 min) o prefieres empezar por deberes primero?`;
    }

    if(raw === "TRABAJO" || low.includes("trabajo")){
      return `Genial. Trabajo pendiente: ${demoData.project}.\n\nPara no agobiar, hoy podemos hacer 1 mini-paso: elegir tema + 3 ideas clave. ¬øLo hacemos?`;
    }

    // Frase cl√°sica (por si alguien escribe ‚Äúagenda‚Äù o ‚Äúqu√© hacemos hoy‚Äù)
    if (low.includes("qu√© hacemos hoy") || low.includes("que hacemos hoy") || low.includes("agenda")){
      return `Hoy te conviene centrarte en esto:\n\n‚úÖ Deberes de ma√±ana\n- ${demoData.homework.join("\n- ")}\n\nüìå Pr√≥ximo examen\n- ${demoData.exam}\n\nüìÇ Trabajo\n- ${demoData.project}\n\n¬øEmpezamos por Deberes, Examen o Trabajo?`;
    }

    return "Vale. Si quieres, pulsa Deberes / Examen / Trabajo en la agenda de arriba, o dime qu√© necesitas y lo ajusto.";
  }

  // --------- ENVIAR TEXTO ---------
  function update(){
    btn.disabled = inp.value.trim().length === 0;
  }

  function pushToLog(role, text){
    const log = loadLog();
    log.push({role, text});
    saveLog(log);
    addBubble(role, text);
    scrollToBottom();
  }

  function sendText(text){
    ensureToday();
    const t = String(text || "").trim();
    if(!t) return;

    pushToLog("user", t);
    pushToLog("assistant", demoAnswer(t));
    setTimeout(() => inp.focus(), 0);
  }

  function sendFromInput(){
    const text = inp.value.trim();
    if(!text) return;
    inp.value = "";
    update();
    sendText(text);
  }

  // --------- MENSAJES DESDE INDEX (miniBar) ---------
  window.addEventListener("message", (event) => {
    if(event.data === "focusInput"){
      setTimeout(() => inp.focus(), 0);
      return;
    }
    if(event.data && event.data.type === "sendText"){
      sendText(event.data.text);
      return;
    }
  });

  // --------- INIT ---------
  ensureToday();
  renderAgenda();

  // Carga conversaci√≥n del d√≠a si existe
  const log = loadLog();
  if(log.length === 0){
    resetChat();
  }else{
    renderLog(log);
  }

  // Foco al abrir
  window.addEventListener("load", () => {
    setTimeout(() => inp.focus(), 0);
  });

  // Listeners input
  inp.addEventListener("input", update);
  inp.addEventListener("keydown", (e) => { if(e.key === "Enter") sendFromInput(); });
  btn.addEventListener("click", sendFromInput);
</script>

</body>
</html>
