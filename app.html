<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ttutordigital ¬∑ App</title>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;background:#fff;color:#111;height: 100vh;display: flex;flex-direction: column;}
    header{display:flex;gap:12px;align-items:center;padding:14px;border-bottom:1px solid #eee;background:#fff;position: sticky;top: 0;z-index: 10;}
    a.back{text-decoration:none;color:#111;font-weight:700;}
    .title{font-weight:900;}
    .sub{font-size:13px;color:#666;margin-top:2px;}
   main{flex: 1;overflow: auto;background:#fafafa;padding:14px;}
    .row{display:flex;margin-bottom:10px;}
    .bubble{
      max-width:560px;padding:10px 12px;border-radius:14px;white-space:pre-wrap;line-height:1.35;
      box-shadow:0 1px 0 rgba(0,0,0,.04);
    }
    .a{justify-content:flex-start;}
    .a .bubble{background:#f2f2f2;}
    .u{justify-content:flex-end;}
    .u .bubble{background:#111;color:#fff;}
   footer{display:flex;gap:8px;padding:12px;border-top:1px solid #eee;background:#fff;position: sticky;bottom: 0;}
    input{flex:1;padding:10px 12px;border-radius:10px;border:1px solid #ddd;outline:none;}
    button{padding:10px 14px;border-radius:10px;border:1px solid #111;background:#111;color:#fff;font-weight:800;}
    button:disabled{opacity:.5}
  </style>
</head>
<body>

<header>
  <a class="back" href="./index.html">‚Üê Inicio</a>
  <div>
    <div class="title">Ttutordigital</div>
    <div class="sub">Modo alumno ¬∑ Demo</div>
  </div>
</header>

<main id="chat">
  <div class="row a"><div class="bubble">Hola, Juan. ¬øQu√© hacemos hoy? (Escribe: ‚Äú¬øQu√© hacemos hoy?‚Äù)</div></div>
</main>

<footer>
  <input id="inp" placeholder="Escribe aqu√≠‚Ä¶" />
  <button id="btn" disabled>Enviar</button>
</footer>

<script>
  const chat = document.getElementById("chat");
  const inp = document.getElementById("inp");
  const btn = document.getElementById("btn");
  // ---------- REINICIO DIARIO (modo 2) ----------
const DAY_KEY = "ttd_chat_day";

function todayStr(){
  const d = new Date();
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,"0");
  const day = String(d.getDate()).padStart(2,"0");
  return `${y}-${m}-${day}`;
}

function resetChat(){
  chat.innerHTML = "";
  // Mensaje inicial (opcional)
  add("assistant", "Hola, Juan. ¬øQu√© hacemos hoy?");
}

function ensureToday(){
  const saved = localStorage.getItem(DAY_KEY);
  const t = todayStr();
  if(saved !== t){
    localStorage.setItem(DAY_KEY, t);
    resetChat();
  }
}

// Al cargar la p√°gina del chat, comprueba si hay que reiniciar
ensureToday();
  // Enfoca el input al cargar la app
window.addEventListener("load", () => {
  setTimeout(() => inp.focus(), 0);
});
  

  function add(role, text){
    const row = document.createElement("div");
    row.className = "row " + (role === "user" ? "u" : "a");
    const bub = document.createElement("div");
    bub.className = "bubble";
    bub.textContent = text;
    row.appendChild(bub);
    chat.appendChild(row);
    chat.scrollTop = chat.scrollHeight;
  }

  function demoAnswer(t){
    t = t.toLowerCase();
    if (t.includes("qu√© hacemos hoy") || t.includes("que hacemos hoy") || t.includes("hoy")){
      return `Hoy te conviene centrarte en esto:

‚úÖ Para ma√±ana
- Matem√°ticas: ejercicios 5 y 6 (p√°g. 123).

üìå Pr√≥ximo examen
- Historia: Tema 7 (primer repaso hoy).

üß† Para reforzar
- Ingl√©s: 15 min de pasado simple.

¬øEmpezamos por Matem√°ticas, Historia o Ingl√©s?`;
    }
    return "Vale. Si quieres, dime: ‚Äú¬øQu√© hacemos hoy?‚Äù y te organizo el plan.";
  }

  function update(){
    btn.disabled = inp.value.trim().length === 0;
  }

  function send(){
    ensureToday();
  const text = inp.value.trim();
  if(!text) return;
  inp.value = "";
  update();
  add("user", text);
  add("assistant", demoAnswer(text));
  inp.focus();
}

  inp.addEventListener("input", update);
  inp.addEventListener("keydown", (e) => { if(e.key === "Enter") send(); });
  btn.addEventListener("click", send);
  // Permite que la p√°gina principal pida foco en el input del chat
window.addEventListener("message", (event) => {
  if (event.data === "focusInput") {
    setTimeout(() => inp.focus(), 0);
  }
});

// Al cargar el chat, enfoca autom√°ticamente
window.addEventListener("load", () => {
  setTimeout(() => inp.focus(), 0);
  // Recibe texto desde index.html (miniBar) y lo procesa como si lo escribieras aqu√≠
window.addEventListener("message", (event) => {
  // Mant√©n lo de focusInput que ya tienes
  if (event.data === "focusInput") {
    setTimeout(() => inp.focus(), 0);
    return;
  }

  // Nuevo: enviar texto remoto
  if (event.data && event.data.type === "sendText") {
    ensureToday(); // tu reinicio diario

    const text = String(event.data.text || "").trim();
    if(!text) return;

    // A√±ade mensaje de usuario + respuesta
    add("user", text);
    add("assistant", demoAnswer(text));

    // Enfoca el input del chat
    setTimeout(() => inp.focus(), 0);
  }
});
});
</script>

</body>
</html>
