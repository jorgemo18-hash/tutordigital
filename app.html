<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ttutordigital ¬∑ App</title>
  <style>
    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;
      background:#fff;
      color:#111;
      height:100vh;
      display:flex;
      flex-direction:column;
    }
    header{
      display:flex;gap:12px;align-items:center;padding:14px;
      border-bottom:1px solid #eee;background:#fff;
      position:sticky;top:0;z-index:10;
    }
    a.back{text-decoration:none;color:#111;font-weight:700;}
    .title{font-weight:900;}
    .sub{font-size:13px;color:#666;margin-top:2px;}

    main{flex:1;overflow:auto;background:#fafafa;padding:14px;}

    /* ---------- AGENDA / BOTONES ---------- */
    .agendaCard{
      background:#fff;
      border:1px solid #eee;
      border-radius:16px;
      padding:14px;
      box-shadow:0 10px 30px rgba(0,0,0,.04);
      margin-bottom:14px;
    }
    .agendaTitle{
      font-weight:900;
      margin:0 0 10px;
      font-size:15px;
    }
    .agendaBtns{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:10px;
    }
    .abtn{
      border:1px solid #ddd;
      background:#fff;
      border-radius:12px;
      padding:10px 12px;
      font-weight:800;
      cursor:pointer;
    }
    .abtn:hover{border-color:#bbb}
    .abtn.primary{
      border-color:#111;
      background:#111;
      color:#fff;
    }
    .alist{
      margin:0;
      padding-left:18px;
      color:#333;
      line-height:1.45;
      font-size:14px;
    }
    .block{
      margin-top:10px;
      padding-top:10px;
      border-top:1px solid #eee;
    }
    .blockTitle{
  font-weight:900;
  margin-bottom:6px;
}

.blockText{
  font-size:14px;
  color:#333;
}

.agendaBtn{
  cursor:pointer;
  transition:background .15s ease, transform .1s ease;
}

.agendaBtn:hover{
  background:#f7f7f7;
  transform:translateY(-1px);
}
    .hint{
      margin-top:10px;
      font-size:13px;
      color:#666;
    }

    /* ---------- CHAT ---------- */
    .row{display:flex;margin-bottom:10px;}
    .bubble{
      max-width:560px;padding:10px 12px;border-radius:14px;
      white-space:pre-wrap;line-height:1.35;
      box-shadow:0 1px 0 rgba(0,0,0,.04);
      font-size:14px;
    }
    .a{justify-content:flex-start;}
    .a .bubble{background:#f2f2f2;}
    .u{justify-content:flex-end;}
    .u .bubble{background:#111;color:#fff;}

    footer{
      display:flex;gap:8px;padding:12px;border-top:1px solid #eee;background:#fff;
      position:sticky;bottom:0;
    }
    input{
      flex:1;padding:10px 12px;border-radius:10px;border:1px solid #ddd;
      outline:none;font-size:16px;
    }
    button.send{
      padding:10px 14px;border-radius:10px;border:1px solid #111;
      background:#111;color:#fff;font-weight:800;cursor:pointer;
    }
    button.send:disabled{opacity:.5;cursor:not-allowed;}
  </style>
</head>

<body>

<header>
  <a class="back" href="./index.html">‚Üê Inicio</a>
  <div>
    <div class="title">Ttutordigital</div>
    <div class="sub">Modo alumno ¬∑ Demo</div>
  </div>
</header>

<main>
  <!-- AGENDA (botones reales) -->
  <section class="agendaCard" id="agenda"></section>

  <!-- CHAT -->
  <section id="chat"></section>
</main>

<footer>
  <input id="inp" placeholder="Escribe aqu√≠‚Ä¶" />
  <button class="send" id="btn" disabled>Enviar</button>
</footer>

<script>
  const agenda = document.getElementById("agenda");
  const chat   = document.getElementById("chat");
  const inp    = document.getElementById("inp");
  const btn    = document.getElementById("btn");

  // ---------- REINICIO DIARIO + PERSISTENCIA DEL D√çA ----------
  const DAY_KEY = "ttd_chat_day";
  const CHAT_KEY_PREFIX = "ttd_chat_"; // ttd_chat_YYYY-MM-DD

  function todayStr(){
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,"0");
    const day = String(d.getDate()).padStart(2,"0");
    return `${y}-${m}-${day}`;
  }
  function chatKey(){
    return CHAT_KEY_PREFIX + todayStr();
  }
  function saveChat(){
    try{ localStorage.setItem(chatKey(), chat.innerHTML); }catch(e){}
  }
  function restoreChat(){
    try{
      const html = localStorage.getItem(chatKey());
      if(html){
        chat.innerHTML = html;
        return true;
      }
    }catch(e){}
    return false;
  }

  // ---------- DATOS DEMO (luego esto vendr√° del instituto/alumno) ----------
  const demoData = {
    homework: [
      "Lengua ¬∑ Ejercicios 3 y 4",
      "Tecnolog√≠a ¬∑ Ejercicios 1 y 2",
      "Matem√°ticas ¬∑ Problema 5"
    ],
    exam: "Matem√°ticas ¬∑ viernes",
    project: "Historia ¬∑ entrega en 15 d√≠as"
  };

  function renderAgenda(){
  agenda.innerHTML = `
    <div class="agendaTitle">Agenda de hoy</div>

    <div class="block agendaBtn" data-action="DEBERES">
      <div class="blockTitle">üìò Deberes de ma√±ana</div>
      <ul class="alist">
        ${demoData.homework.map(x => `<li>${x}</li>`).join("")}
      </ul>
    </div>

    <div class="block agendaBtn" data-action="EXAMEN">
      <div class="blockTitle">üìù Pr√≥ximo examen</div>
      <div class="blockText">${demoData.exam}</div>
    </div>

    <div class="block agendaBtn" data-action="TRABAJO">
      <div class="blockTitle">üìÇ Trabajo</div>
      <div class="blockText">${demoData.project}</div>
    </div>

    <div class="hint">
      üí° Mi sugerencia: empieza por los deberes de ma√±ana.  
      Suele ayudar quitarse primero lo que requiere m√°s atenci√≥n.
    </div>
  `;

  document.querySelectorAll(".agendaBtn").forEach(el => {
    el.addEventListener("click", () => {
      sendText(el.dataset.action);
    });
  });
}

    // Clicks -> env√≠an ‚Äúintenci√≥n‚Äù al chat (sin ventanas nuevas)
    document.getElementById("btnHomework").onclick = () => sendText("DEBERES");
    document.getElementById("btnExam").onclick     = () => sendText("EXAMEN");
    document.getElementById("btnProject").onclick  = () => sendText("TRABAJO");
  }

  // ---------- CHAT ----------
  function add(role, text){
    const row = document.createElement("div");
    row.className = "row " + (role === "user" ? "u" : "a");

    const bub = document.createElement("div");
    bub.className = "bubble";
    bub.textContent = text;

    row.appendChild(bub);
    chat.appendChild(row);
    chat.scrollTop = chat.scrollHeight;
    saveChat();
  }

  function resetChat(){
    chat.innerHTML = "";
    add("assistant", "Hola, Juan. ¬øQu√© hacemos hoy? (Escribe ‚Äú¬øQu√© hacemos hoy?‚Äù o toca una secci√≥n de la agenda.)");
    try{ localStorage.removeItem(chatKey()); }catch(e){}
    saveChat();
  }

  function ensureToday(){
    const saved = localStorage.getItem(DAY_KEY);
    const t = todayStr();

    if(saved !== t){
      localStorage.setItem(DAY_KEY, t);
      resetChat();
      return;
    }

    if(chat.innerHTML.trim() === ""){
      const ok = restoreChat();
      if(!ok) resetChat();
    }
  }

  // ---------- RESPUESTAS DEMO (ahora con ‚Äúintenciones‚Äù de botones) ----------
  function demoAnswer(t){
    const s = (t || "").toLowerCase();

    if(s === "deberes"){
      return `Perfecto. Vamos con los deberes de ma√±ana.

Tienes:
- ${demoData.homework.join("\n- ")}

Dime por cu√°l quieres empezar: Lengua, Tecnolog√≠a o Matem√°ticas.`;
    }

    if(s === "examen"){
      return `Vale. Pr√≥ximo examen:

- ${demoData.exam}

Dime qu√© tema entra (o qu√© te cuesta m√°s) y lo repasamos paso a paso.`;
    }

    if(s === "trabajo"){
      return `Hecho. Trabajo pendiente:

- ${demoData.project}

¬øQuieres que lo dividamos en 3 partes (b√∫squeda, esquema, redacci√≥n) para avanzar sin agobio?`;
    }

    if (s.includes("qu√© hacemos hoy") || s.includes("que hacemos hoy") || s.trim() === "hoy"){
      return `Aqu√≠ tienes tu agenda arriba.

Mi sugerencia: empieza por los deberes de ma√±ana. Si quieres, toca ‚Äúüìò Deberes de ma√±ana‚Äù y seguimos.`;
    }

    // Si el alumno escribe una asignatura, respondemos ‚Äúcomo tutor‚Äù
    if(s.includes("lengua")){
      return "Genial. Vamos con Lengua. Dime qu√© apartado te cuesta o p√©game el enunciado del ejercicio 3.";
    }
    if(s.includes("matem√°ticas") || s.includes("matematicas")){
      return "Perfecto. Vamos con Matem√°ticas. ¬øQu√© parte del problema 5 te atasca? (datos, planteamiento o c√°lculo)";
    }
    if(s.includes("tecnolog√≠a") || s.includes("tecnologia")){
      return "Vale. Tecnolog√≠a. ¬øDe qu√© va el ejercicio 1? Escr√≠beme el enunciado o una foto y lo resolvemos.";
    }

    return "Vale. Si quieres, escribe ‚Äú¬øQu√© hacemos hoy?‚Äù o toca una secci√≥n de la agenda (Deberes / Examen / Trabajos).";
  }

  // ---------- INPUT ----------
  function update(){
    btn.disabled = inp.value.trim().length === 0;
  }

  function sendText(text){
    ensureToday();
    const clean = String(text || "").trim();
    if(!clean) return;

    add("user", clean);
    add("assistant", demoAnswer(clean));

    inp.value = "";
    update();
    setTimeout(() => inp.focus(), 0);
  }

  function send(){
    sendText(inp.value);
  }

  inp.addEventListener("input", update);
  inp.addEventListener("keydown", (e) => {
    if(e.key === "Enter") send();
  });
  btn.addEventListener("click", send);

  // ---------- MENSAJES DESDE INDEX (FOCO / MINI BAR) ----------
  window.addEventListener("message", (event) => {
    if(event.data === "focusInput"){
      setTimeout(() => inp.focus(), 0);
      return;
    }
    if(event.data && event.data.type === "sendText"){
      sendText(event.data.text);
      return;
    }
  });

  // ---------- INIT ----------
  window.addEventListener("load", () => {
    renderAgenda();
    ensureToday();
    setTimeout(() => inp.focus(), 0);
  });
</script>

</body>
</html>
