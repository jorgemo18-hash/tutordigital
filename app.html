<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ttutordigital · App</title>

  <style>
    :root{
      --bg:#fafafa;
      --card:#fff;
      --text:#111;
      --muted:#666;
      --line:#eaeaea;
      --shadow:0 12px 30px rgba(0,0,0,.08);
      --shadow2:0 18px 50px rgba(0,0,0,.10);
      --radius:16px;
    }

    *{box-sizing:border-box}
    html, body { height:100%; }

    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;
      background:var(--bg);
      color:var(--text);
      height:100%;
    }

    .wrap{
      height:100%;
      display:flex;
      flex-direction:column;
      align-items:center;
    }

    .shell{
      width:100%;
      height:100%;
      display:flex;
      flex-direction:column;
      background:var(--card);
    }

    @media (min-width: 900px){
      body{ background:#f0f0f0; }
      .shell{
        width:min(980px, 94vw);
        margin:18px 0;
        border:1px solid var(--line);
        border-radius:18px;
        box-shadow:var(--shadow2);
        overflow:hidden;
        height:calc(100% - 36px);
      }
    }

    header{
      display:flex;
      gap:12px;
      align-items:flex-start;
      padding:14px 16px;
      border-bottom:1px solid var(--line);
      background:#fff;
      flex:0 0 auto;
    }

    a.back{
      text-decoration:none;
      color:#111;
      font-weight:800;
      white-space:nowrap;
    }
    .title{font-weight:900;}
    .sub{font-size:13px;color:var(--muted);margin-top:2px;}

    main{
      flex:1 1 auto;
      overflow:auto;
      background:var(--bg);
      padding:14px;
    }

    /* ---------- CHAT ---------- */
    .row{display:flex;margin-bottom:10px;}
    .bubble{
      max-width:680px;
      padding:10px 12px;
      border-radius:14px;
      white-space:pre-wrap;
      line-height:1.35;
      box-shadow:0 1px 0 rgba(0,0,0,.04);
      font-size:15px;
    }
    .a{justify-content:flex-start;}
    .a .bubble{background:#f2f2f2;}
    .u{justify-content:flex-end;}
    .u .bubble{background:#111;color:#fff;}

    footer{
      position: sticky;
      bottom: 0;
      z-index: 10;
      flex:0 0 auto;
      display:flex;
      gap:8px;
      padding:12px;
      border-top:1px solid var(--line);
      background:#fff;
    }

    input{
      flex:1;
      padding:12px;
      border-radius:12px;
      border:1px solid #ddd;
      outline:none;
      font-size:16px;
    }

    button.send{
      padding:12px 14px;
      border-radius:12px;
      border:1px solid #111;
      background:#111;
      color:#fff;
      font-weight:900;
      font-size:16px;
      cursor:pointer;
    }
    button.send:disabled{opacity:.5;}

    /* ---------- TECLADO CIENTÍFICO INTERNO (MÓVIL) ---------- */
    #pad{
      display:none;
      border-top:1px solid var(--line);
      background:#fff;
      padding:10px 12px;
    }
    #pad.show{ display:block; }

    #pad .padRow{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }

    #pad button{
      border:1px solid #ddd;
      background:#fff;
      border-radius:10px;
      padding:7px 10px;
      font-weight:900;
      cursor:pointer;
      font-size:13px;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="shell">

      <header>
        <a class="back" href="./index.html">← Inicio</a>
        <div>
          <div class="title">Ttutordigital</div>
          <div class="sub">Modo alumno · Demo</div>
        </div>
      </header>

      <main id="chat"></main>

      <footer>
        <input id="inp" placeholder="Escribe aquí…" autocomplete="off" />
        <button class="send" id="kbd" type="button">∑</button>
        <button class="send" id="btn" disabled>Enviar</button>
      </footer>

      <!-- Teclado científico interno -->
      <div id="pad">
        <div class="padRow">
          <button data-i="()">()</button>
          <button data-i="+">+</button>
          <button data-i="-">−</button>
          <button data-i="*">×</button>
          <button data-i="/">÷</button>
          <button data-i="x^2">x²</button>
          <button data-i="x^3">x³</button>
          <button data-i="^{}">x^</button>
          <button data-i="√()">√</button>
          <button data-i="π">π</button>
        </div>
      </div>

    </div>
  </div>

  <script>
    const chat = document.getElementById("chat");
    const inp  = document.getElementById("inp");
    const btn  = document.getElementById("btn");
    const kbd  = document.getElementById("kbd");
    const pad  = document.getElementById("pad");

    function update(){
      btn.disabled = inp.value.trim().length === 0;
    }

    function insertWithCursor(text, cursorAt){
      const start = inp.selectionStart ?? inp.value.length;
      const end   = inp.selectionEnd ?? inp.value.length;
      inp.value = inp.value.slice(0,start) + text + inp.value.slice(end);
      const pos = start + cursorAt;
      inp.setSelectionRange(pos,pos);
      inp.focus();
      update();
    }

    function handleInsert(v){
      if (v === "()") return insertWithCursor("()",1);
      if (v === "^{}") return insertWithCursor("^()",2);
      if (v === "√()") return insertWithCursor("sqrt()",5);
      if (v === "/") return insertWithCursor("()/()",1);
      if (v === "x^2") return insertWithCursor("x^2",3);
      if (v === "x^3") return insertWithCursor("x^3",3);
      return insertWithCursor(v,v.length);
    }

    kbd.addEventListener("click", () => {
      const inIframe = window.parent && window.parent !== window;
      if (inIframe){
        window.parent.postMessage({ type:"togglePad" },"*");
      } else {
        pad.classList.toggle("show");
      }
      setTimeout(()=>inp.focus(),0);
    });

    pad.addEventListener("click",(e)=>{
      const b = e.target.closest("button[data-i]");
      if(!b) return;
      handleInsert(b.dataset.i);
    });

    window.addEventListener("message",(e)=>{
      if(!e.data) return;
      if(e.data.type==="insert") handleInsert(e.data.value);
      if(e.data.type==="moveCursor"){
        const pos = inp.selectionStart + e.data.offset;
        inp.setSelectionRange(pos,pos);
        inp.focus();
      }
    });

    inp.addEventListener("input",update);
  </script>
</body>
</html>
